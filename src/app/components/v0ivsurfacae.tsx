"use client"

import React, { useRef, useMemo } from 'react'
import { Canvas, useFrame } from '@react-three/fiber'
import { OrbitControls, Text } from '@react-three/drei'
import * as THREE from 'three'

// Sample data (replace with your actual data)
const sampleData = [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 3.5156262109374996, 3.37656405859375, 3.2375019062499995, 3.09843975390625, 2.9593776015625, 2.82031544921875, 2.6640658398437504, 2.5156287109374995, 2.3750040624999995, 2.826174809570312, 2.6621127197265633, 2.501956870117187, 2.345707260742187, 1.78515732421875, 1.6601579492187502, 1.4765651171875, 1.7626964990234375, 1.6591813916015625, 1.23047259765625, 1.0351610742187503, 1.123051259765625, 0.87500125, 0.8906260937499999, 0.80664255859375, 0.989257919921875, 0.901368173828125, 0.858399853515625, 0.5664105859375, 0.5625043750000001, 0.52539537109375, 0.6123085644531252, 0.5449264257812501, 0.4760794580078125, 0.41797457031249996, 0.3544986425781249, 0.2395095581054687, 0.1928791650390625, 0.16748879394531252, 0.15406119384765626, 0.1562584375, 0.17090672851562502, 0.1914143359375, 0.21094539062499998, 0.2500075, 0.2890696093749999, 0.35938140625, 0.42969320312500003, 0.49219257812500006, 0.5312546875, 0.57812921875, 0.64062859375, 0.6875031250000001, 0.7500025, 0.8125018749999999, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 6.122073190307616, 1.7578181054687498, 4.467775655517578, 3.757326519165038, 3.0468773828124998, 2.957033857421875, 1.7578181054687498, 2.8242216894531245, 2.716797685546875, 2.6640635742187495, 2.0937547656249995, 2.1237019628906246, 2.1536491601562497, 2.183596357421875, 2.3706071411132816, 2.006350954589844, 2.022952248535156, 1.453127734375, 2.006839436035156, 1.3125034374999998, 1.7963908642578124, 1.173832255859375, 1.1318402783203125, 1.0546922265625, 1.0068409033203123, 0.9062509375, 0.9599613378906249, 0.7856466748046875, 0.7334011035156249, 0.72070591796875, 0.704104521484375, 0.6743196630859377, 0.5488326367187502, 0.5283250292968751, 0.5493209130859377, 0.5161181201171875, 0.5715374877929689, 0.43555251953125, 0.41309180664062495, 0.3940490283203125, 0.4035704174804688, 0.2995675512695312, 0.33484551879882807, 0.2475661181640625, 0.2525709509277344, 0.18518881225585934, 0.17701018310546873, 0.16748879394531252, 0.16529155029296877, 0.16285016845703126, 0.16553568847656253, 0.17383638671875, 0.18262536132812499, 0.198250205078125, 0.22266402343749997, 0.26367923828125, 0.31445998046874996, 0.3437565625, 0.3632876171875, 0.398443515625, 0.4179745703125, 0.437505625, 0.4687553125, 0.6210975390625, 0.6289099609375, 0.6523472265625, 0.6621127539062499, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [6.0000025, 8.728520169677733, 7.4531256835937505, 1.0000000000000003e-05, 2.709967550048827, 5.419925100097655, 4.709475963745116, 3.9990268273925773, 3.2885776910400386, 2.5781285546875, 2.5468786328124997, 2.3984415039062497, 2.5156287109374995, 1.0000000000000003e-05, 2.2070357324218746, 2.1328171679687498, 1.0000000000000003e-05, 1.9179691601562503, 1.853516357421875, 1.8125009374999999, 1.78515732421875, 1.74609501953125, 1.5468772656249998, 1.50390873046875, 1.9208988330078127, 1.3486360693359374, 1.5302757861328122, 1.21875390625, 1.1875040625, 1.0947310888671877, 1.0908248583984377, 1.0649460815429688, 1.01172369140625, 0.86914193359375, 0.807619111328125, 0.7631859619140625, 0.7041045214843751, 0.6699251757812501, 0.5996133789062501, 0.5424850439453126, 0.53320779296875, 0.569340244140625, 0.6291540991210938, 0.49341326904296884, 0.4626518579101563, 0.43164630859375, 0.40650007568359375, 0.39063109375, 0.411138701171875, 0.3347234497070312, 0.3654848608398438, 0.2594068200683594, 0.2430495617675781, 0.21595022338867187, 0.2533033654785156, 0.19068192138671874, 0.18372398315429686, 0.17566742309570313, 0.1724936267089844, 0.1687094848632813, 0.17041845214843754, 0.1694418994140625, 0.17237155761718753, 0.1772543212890625, 0.192390888671875, 0.20996883789062498, 0.22266402343749997, 0.26367923828125, 0.2910227148437499, 0.304694453125, 0.34766277343749996, 0.35742830078125, 0.38281867187499996, 0.4062559375, 0.42969320312500003, 0.42578699218750005, 0.445318046875, 0.4687553125, 0.49219257812500006, 0.507817421875, 0.5117236328125, 0.51562984375, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [6.164064794921875, 7.688969324035643, 6.594728319091797, 0.878425772705078, 2.8474175314331047, 4.811038209838866, 4.358157635803222, 3.647708499450683, 2.937259363098144, 2.5478551928710935, 2.5051306903076167, 2.3520549011230463, 2.4206582452392573, 0.4912184814453125, 2.140506365356445, 2.026981403198242, 0.42530084228515624, 1.8536384271240238, 1.789673903198242, 1.6619483048502603, 1.630047422688802, 1.5922871948242185, 1.4378283317057292, 1.392906681315104, 1.6507178922526042, 1.2382850585937497, 0.8437515624999999, 0.79687703125, 0.9057651977539062, 1.0146533642578124, 0.9545902978515625, 0.8959971337890623, 0.8483901879882811, 0.8007832421875, 0.622074091796875, 0.532231240234375, 0.6521030883789063, 0.5822795678710937, 0.5512740185546876, 0.5031787963867188, 0.49396257995605475, 0.48474636352539063, 0.46307909973144534, 0.4414118359375, 0.4120542193603515, 0.38269660278320305, 0.35785554260253905, 0.33301448242187504, 0.31970895141601563, 0.3064034204101562, 0.28830667755126954, 0.27020993469238286, 0.2425002508544922, 0.21479056701660154, 0.19919624053955076, 0.18360191406249998, 0.17734587310791017, 0.17108983215332033, 0.1681296566772461, 0.1651694812011719, 0.16431499755859377, 0.16346051391601565, 0.1663291375732422, 0.16919776123046876, 0.180672255859375, 0.1977619287109375, 0.21875781249999998, 0.23535920898437498, 0.25391371093750004, 0.352545537109375, 0.38086556640624997, 0.31445998046874996, 0.32031929687499994, 0.362311064453125, 0.3911193701171875, 0.3891662646484375, 0.42310147216796873, 0.42822837402343755, 0.4492242578125, 0.463872548828125, 0.47022014160156245, 0.476567734375, 0.48242705078125, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [6.3281270898437505, 6.649418478393554, 5.736330954589844, 1.756841545410156, 2.984867512817382, 4.202151319580077, 4.006839307861327, 3.296390171508788, 2.58594103515625, 2.5175818310546876, 2.463382747802734, 2.3056682983398433, 2.325687779541015, 0.982426962890625, 2.0739769982910152, 1.9211456384277341, 0.8505916845703125, 1.7893076940917971, 1.7258314489746094, 1.554750761413574, 1.474937521158854, 1.4384793701171874, 1.3287793977864584, 1.2819046321614584, 1.380536951497396, 1.1804240197753906, 0.9255403723144531, 0.9167514709472658, 1.0014698364257812, 0.6972686523437501, 0.9304206176757812, 0.9191902612304688, 0.8298356860351562, 0.7404811108398437, 0.7092314233398438, 0.7131376342773439, 0.6191444335937502, 0.6091347680664063, 0.5584760949707033, 0.5083056982421875, 0.4813284289550781, 0.45435115966796874, 0.43189044677734373, 0.4094297338867187, 0.38660281372070315, 0.36377589355468753, 0.34705242797851565, 0.3303289624023437, 0.3311834460449219, 0.3320379296875, 0.28613995117187496, 0.24024197265624997, 0.2324905853271484, 0.22473919799804684, 0.2069171105957031, 0.18909502319335939, 0.1850362258911133, 0.18097742858886717, 0.17746794219970702, 0.1739584558105469, 0.17432466308593753, 0.17469087036132813, 0.1708456939697266, 0.16700051757812504, 0.1753012158203125, 0.18872881591796875, 0.20264469238281246, 0.22364057617187497, 0.23763783203124997, 0.251635087890625, 0.26563234375, 0.36133451171875, 0.29492892578124996, 0.32373723144531247, 0.352545537109375, 0.352545537109375, 0.4008848974609375, 0.387701435546875, 0.4062559375, 0.41992767578125, 0.42871665039062495, 0.437505625, 0.437505625, 0.44922425781249997, 0.460942890625, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [6.492189384765626, 5.609867632751465, 4.877933590087891, 2.635257318115234, 3.1223174942016594, 3.5932644293212883, 3.3979524176025384, 2.945071843566894, 2.5302771118164067, 2.4873084692382816, 2.4216348052978516, 2.25928169555664, 2.230717313842773, 1.4736354443359374, 2.0074476312255856, 1.8153098736572262, 1.2758825268554688, 1.7249769610595704, 1.6619889947509765, 1.4909083071899412, 1.319827619628906, 1.284671545410156, 1.2197304638671875, 1.1709025830078126, 1.1103560107421875, 1.1225629809570314, 1.007329182128906, 1.0366259106445317, 1.0105029943847654, 0.8974619628906249, 0.9062509375, 0.8129901513671874, 0.68555001953125, 0.7170438452148438, 0.672122419433594, 0.6191444335937502, 0.6433141137695313, 0.5007374145507812, 0.5258836474609375, 0.48328153442382815, 0.46185840881347656, 0.44043528320312497, 0.42053802124023437, 0.40064075927734377, 0.3779206495666504, 0.355200539855957, 0.34047595565795896, 0.3257513714599609, 0.3272467178344726, 0.32874206420898433, 0.3061592822265624, 0.28357650024414055, 0.25153336364746093, 0.21949022705078125, 0.21649953430175783, 0.2135088415527344, 0.20615417877197267, 0.19879951599121093, 0.19409985595703125, 0.18940019592285157, 0.1813436358642578, 0.17328707580566405, 0.17313448944091797, 0.1729819030761719, 0.1771322521972656, 0.186531572265625, 0.19678537597656248, 0.21094539062499998, 0.22307092041015625, 0.23706817626953122, 0.24805439453125, 0.26367923828125, 0.2739330419921875, 0.28516339843749994, 0.3139717041015625, 0.31592480957031244, 0.3786683227539062, 0.34717449707031245, 0.36328761718749997, 0.375982802734375, 0.38721315917968746, 0.39844351562499997, 0.40430283203125, 0.4062559375, 0.41602146484374997, 0.42774009765625, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [6.656251679687501, 4.570316787109375, 4.019536225585938, 3.513673090820312, 3.259767475585937, 2.9843775390625, 2.7890655273437504, 2.593753515625, 2.474613188476563, 2.4570351074218753, 2.3798868627929686, 2.2128950927734365, 2.1357468481445308, 1.96484392578125, 1.9409182641601563, 1.7094741088867185, 1.701173369140625, 1.660646228027344, 1.5981465405273436, 1.323733850097656, 1.3969756713867185, 1.3772003796386718, 1.3251986865234373, 1.2434119860839843, 1.206302796630859, 1.1450238061523437, 0.9594730615234374, 0.9370123486328125, 0.85742330078125, 0.9252937158203125, 0.7944356494140624, 0.8115253222656249, 0.721804539794922, 0.6757844921875001, 0.6535679174804689, 0.610599597167969, 0.5437057348632813, 0.5162401892089843, 0.4908498181152344, 0.4544732287597656, 0.4391535577392578, 0.42383388671875, 0.39899282653808593, 0.37415176635742187, 0.3603884762573242, 0.3466251861572265, 0.346838807067871, 0.34705242797851554, 0.31235428863525383, 0.2776561492919921, 0.2617871673583984, 0.2459181854248047, 0.2475356008911133, 0.24915301635742187, 0.22718057983398438, 0.20520814331054685, 0.19983710327148435, 0.19446606323242188, 0.18906450592041016, 0.18366294860839844, 0.18161829132080076, 0.17957363403320312, 0.17932949584960936, 0.1790853576660156, 0.178719150390625, 0.18311363769531247, 0.18921709228515626, 0.198250205078125, 0.20850400878906244, 0.22071091796874998, 0.2304764453125, 0.242195078125, 0.252937158203125, 0.25977302734375, 0.27539787109374997, 0.27930408203124996, 0.35645174804687496, 0.30664755859375, 0.32031929687499994, 0.3320379296875, 0.34570966796874997, 0.35938140625, 0.3711000390625, 0.35938140625, 0.37500625, 0.38281867187499996, 0.39453730468750003, 0.4062559375, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [5.198243352050782, 3.8798856250000004, 3.420899885253906, 3.127443587646484, 2.906182558070591, 2.37012076985677, 1.49219376953125, 1.2968817578125, 1.2373115942382815, 1.2285225537109377, 1.8725622058105467, 1.825687231445312, 1.7247354913330075, 0.982426962890625, 1.546877265625, 1.456301546630859, 1.4512966888427734, 1.3828155859375002, 0.7990782702636718, 1.1247602355957032, 1.0244189404296877, 0.9882813671875, 0.9492192578124999, 0.9047861083984375, 0.8647474462890624, 0.866212275390625, 0.791139783935547, 0.7542749182128907, 0.7365748999023438, 0.7205838488769531, 0.6567417138671876, 0.6145058081054688, 0.6043740734863283, 0.5620160986328125, 0.5319871020507813, 0.5271043383789062, 0.47998566894531247, 0.49805189453125004, 0.42090422851562503, 0.394110062866211, 0.38706057281494144, 0.3800110827636719, 0.3928893719482422, 0.4057676611328125, 0.3629214099121093, 0.3200751586914062, 0.32913878875732416, 0.3382024188232422, 0.3234015414428711, 0.3086006640625, 0.2876047802734375, 0.266608896484375, 0.2598798377990723, 0.2531507791137696, 0.2533491413879395, 0.25354750366210943, 0.24271387176513673, 0.23188023986816403, 0.22806558074951166, 0.22425092163085933, 0.2217485052490234, 0.2192460888671875, 0.21723194885253905, 0.21521780883789063, 0.21210504699707028, 0.2108233215332031, 0.21070125244140625, 0.2124102197265625, 0.21436332519531248, 0.2172929833984375, 0.2211991943359375, 0.22632609619140626, 0.2309647216796875, 0.2368240380859375, 0.24268335449218748, 0.249030947265625, 0.25391371093750004, 0.2617261328125, 0.26856200195312496, 0.2919992675781249, 0.27735097656249996, 0.317389638671875, 0.3320379296875, 0.33008482421874996, 0.29688203124999996, 0.32617861328125, 0.32617861328125, 0.32227240234374993, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [3.740235024414063, 3.3281266796874998, 2.995119699707031, 2.773858670131138, 2.5525976405552453, 2.3313366109793523, 1.480474064127604, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.365237548828125, 1.4384793701171876, 1.3137241345214843, 1.0000000000000003e-05, 1.1528362670898438, 1.203128984375, 1.2014200085449218, 1.1049849438476564, 1.0000000000000003e-05, 0.9711916943359374, 0.9838868798828125, 0.8942881665039062, 0.8652357226562499, 0.8293474096679687, 1.0000000000000003e-05, 0.7583031982421876, 0.7849142602539063, 0.700198310546875, 0.668094139404297, 0.6398961791992188, 0.6074258007812501, 0.5798381860351562, 0.5537154003906251, 0.5250901983642577, 0.5070850073242188, 0.4804739453125, 0.45166563964843753, 0.43237872314453124, 0.40143420837402344, 0.4288387194824219, 0.4069883520507812, 0.38513798461914056, 0.3739686627197265, 0.3627993408203125, 0.3490360507202148, 0.3352727606201171, 0.3174048973083496, 0.29953703399658205, 0.29326573440551756, 0.2869944348144531, 0.2788920988464355, 0.27078976287841794, 0.2717663156127929, 0.2727428683471679, 0.26227544372558587, 0.25180801910400386, 0.2489241368103027, 0.24604025451660155, 0.24552146087646484, 0.24500266723632813, 0.23545076080322264, 0.2258988543701172, 0.2238236798095703, 0.2217485052490234, 0.21860522613525388, 0.21759815612792968, 0.21573660247802734, 0.21497367065429687, 0.21588918884277342, 0.21680470703125, 0.2192460888671875, 0.22168747070312497, 0.22492230163574217, 0.22815713256835937, 0.23590851989746092, 0.2368240380859375, 0.2420730090332031, 0.24732197998046873, 0.2523268127441406, 0.2573316455078125, 0.26367923828125, 0.2700268310546875, 0.27271235107421876, 0.27539787109374997, 0.2836985693359374, 0.2919992675781249, 0.29395237304687494, 0.295905478515625, 0.34850853785923575, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [3.235353474121094, 2.862795811767578, 2.6415347821916852, 2.4202737526157923, 2.1990127230398997, 1.9777516934640067, 1.7564906638881137, 0.5908273583984375, 0.576178994140625, 0.6115792077636719, 1.2651403930664062, 1.2894322637939455, 0.6568670672607422, 0.5113599822998047, 1.06750708984375, 1.0638451428222657, 1.0465113275146485, 0.982424813232422, 0.41455663574218743, 0.8851940191650391, 0.8762829754638672, 0.8454605297851561, 0.8139667041015625, 0.7756370092773439, 0.7750266638183594, 0.7202176416015625, 0.7124052197265626, 0.6800569104003908, 0.6536899865722658, 0.6049844189453126, 0.589969920654297, 0.5500533276367189, 0.5407150421142579, 0.5145922564697265, 0.51562984375, 0.5158129473876953, 0.4434259759521484, 0.42792320129394534, 0.4024717956542969, 0.3967345483398438, 0.37378555908203126, 0.3508365698242187, 0.3418492329406738, 0.3328618960571289, 0.33518120880126956, 0.3375005215454102, 0.3288488746643066, 0.32019722778320303, 0.3037179003906249, 0.2872385729980468, 0.290198748474121, 0.29315892395019527, 0.27828175338745115, 0.263404582824707, 0.2752300260925293, 0.28705546936035153, 0.2662732064819336, 0.24549094360351562, 0.24385826950073242, 0.2422255953979492, 0.23738860763549802, 0.23255161987304687, 0.23050696258544923, 0.22846230529785155, 0.22510540527343748, 0.22196212615966793, 0.22077195251464843, 0.21936815795898437, 0.21875781249999998, 0.21912401977539062, 0.21973436523437498, 0.2210771252441406, 0.22327436889648436, 0.2254716125488281, 0.2291336853027344, 0.2299881689453125, 0.2348709326171875, 0.23731231445312498, 0.24097438720703124, 0.245124736328125, 0.25092301818847657, 0.2567213000488281, 0.25940682006835936, 0.27077450424194327, 0.27907520248413076, 0.2879998094177245, 0.289388345336914, 0.29134145080566404, 0.29744878060477115, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [2.7304719238281248, 2.509210894252232, 2.287949864676339, 2.066688835100446, 1.8454278055245537, 1.6241667759486607, 1.4029057463727679, 1.1816447167968749, 1.15234798828125, 1.2231484155273438, 1.1650432373046877, 1.1403851574707033, 1.0000000000000003e-05, 1.0227099645996094, 0.9821779125976562, 0.9245613012695313, 0.8916026464843749, 0.8598646826171875, 0.8291032714843749, 0.7991963439941407, 0.7686790710449221, 0.7390162817382812, 0.7117948742675781, 0.6865265722656251, 0.6630282720947267, 0.6397130755615235, 0.6143837390136719, 0.5885050915527343, 0.5681195532226562, 0.543949873046875, 0.5210008837890624, 0.5114184600830078, 0.4935353381347657, 0.47095255615234377, 0.45117736328125, 0.4299373413085938, 0.4335994140625, 0.4141904284667969, 0.39649041015625003, 0.3721681436157227, 0.3585116639709473, 0.3448551843261719, 0.3380803497314453, 0.33130551513671874, 0.33321284469604495, 0.3351201742553711, 0.32614809600830075, 0.3171760177612304, 0.309928165435791, 0.3026803131103516, 0.302039450378418, 0.3013985876464844, 0.29289952713012696, 0.2844004666137695, 0.2837443452453613, 0.2830882238769531, 0.2842326216125488, 0.2853770193481445, 0.2711864874267578, 0.25699595550537113, 0.25114426841735843, 0.24529258132934573, 0.24673452247619632, 0.24817646362304688, 0.23863981582641602, 0.2389602471923828, 0.23674774490356443, 0.23453524261474606, 0.23317722396850582, 0.2318192053222656, 0.2313004116821289, 0.2307816180419922, 0.23084265258789063, 0.23090368713378906, 0.23120885986328124, 0.23151403259277342, 0.23307041351318358, 0.23462679443359374, 0.23627472717285153, 0.23792265991210934, 0.24066921447753903, 0.24341576904296874, 0.2578504391479492, 0.2661511373901366, 0.27566362567901603, 0.28400035125732415, 0.2848243176269531, 0.28677742309570314, 0.28668248046875, 0.2989920826939174, 0.0, 0.0, 0.0, 0.0, 0.0], [2.45312728515625, 2.326418934326172, 2.1997105834960937, 1.9784495539202012, 1.757188524344308, 1.5359274947684152, 1.3146664651925226, 1.157393535970052, 1.1197960677083332, 1.1530804064941407, 0.7766988248697919, 0.7602601049804689, 0.2942778906249999, 0.6818099763997397, 0.9473068420410155, 0.6163775341796877, 0.8565281274414063, 0.8345150012207032, 0.7953715124511719, 0.7786887365722657, 0.384344535522461, 0.36951314086914056, 0.7001983105468751, 0.6656832748413086, 0.3315191360473633, 0.3198615377807617, 0.6176185699462893, 0.5718731777954101, 0.5527998822021485, 0.5329636547851562, 0.5255784747314454, 0.504887763671875, 0.4841970526123047, 0.4815420498657227, 0.4788870471191406, 0.42828940856933595, 0.4124814611816406, 0.42307095489501956, 0.37708142456054683, 0.3623415817260742, 0.3601901139831543, 0.3580386462402344, 0.34665570343017577, 0.3352727606201171, 0.3300390483093261, 0.3248053359985351, 0.3180457600402832, 0.3112861840820312, 0.3096229927062988, 0.30795980133056633, 0.29855285194396963, 0.289145902557373, 0.28819223777770986, 0.2872385729980468, 0.28377486251831047, 0.28031115203857415, 0.27899127998352047, 0.27767140792846673, 0.2709194612884521, 0.26416751464843746, 0.26110052871704104, 0.2580335427856446, 0.2600324241638184, 0.26203130554199217, 0.2521742263793946, 0.24500266723632813, 0.24466697723388675, 0.24036404174804685, 0.2401199035644531, 0.2357254162597656, 0.23425041473388675, 0.23194127441406248, 0.23532869171142579, 0.2354202435302734, 0.23633576171874998, 0.23725127990722655, 0.23883817810058594, 0.23581696807861327, 0.2355270539855957, 0.2352371398925781, 0.23854826400756834, 0.24185938812255858, 0.25322707229614255, 0.2633274419403076, 0.27166416751861566, 0.2800008930969238, 0.28026028991699214, 0.2822133953857422, 0.28197942962646483, 0.2823863265991211, 0.3169972737339566, 0.0, 0.0, 0.0, 0.0], [2.1757826464843752, 2.0490742956542967, 1.922365944824219, 1.7956575939941406, 1.6689492431640625, 1.4476882135881697, 1.226427184012277, 1.1289919852701822, 1.0872441471354166, 1.0830123974609376, 0.38835441243489593, 0.38013505249023444, 0.5885457812499999, 0.34090998819986984, 0.9124357714843749, 0.3081937670898438, 0.8214536083984375, 0.8091653198242188, 0.7616397534179689, 0.7581811291503906, 1.0000000000000003e-05, 1.0000000000000003e-05, 0.688601746826172, 0.6448399774169922, 1.0000000000000003e-05, 1.0000000000000003e-05, 0.27762563201904294, 0.5552412640380859, 0.5374802111816408, 0.529850892944336, 0.5098315618896485, 0.48990378265380863, 0.4913075772094727, 0.46985393432617195, 0.45178770874023444, 0.45178770874023444, 0.41992767578125, 0.38794557373046873, 0.3738465936279296, 0.35645174804687496, 0.35036355209350584, 0.3442753561401367, 0.34607587524414063, 0.34787639434814455, 0.3425816474914551, 0.33728690063476563, 0.33133603240966797, 0.3253851641845703, 0.3204871418762207, 0.31558911956787106, 0.30632712722778316, 0.29706513488769526, 0.30350427947998043, 0.3099434240722656, 0.30034574172973627, 0.29074805938720694, 0.29059547302246086, 0.2904428866577148, 0.28403425933837884, 0.2776256320190429, 0.28131822204589835, 0.2850108120727538, 0.27053799537658685, 0.25606517868041995, 0.25220474365234374, 0.2486952572631836, 0.25952888916015626, 0.24326318267822267, 0.2417068017578125, 0.23963162719726558, 0.23899076446533202, 0.23734283172607418, 0.23676300354003904, 0.2352371398925781, 0.23657989990234374, 0.2362136926269531, 0.2366409344482422, 0.2370071417236328, 0.23722076263427733, 0.23743438354492186, 0.23886869537353514, 0.24030300720214842, 0.2509912582015991, 0.2593279837799072, 0.2676647093582153, 0.2760014349365234, 0.27569626220703125, 0.2776493676757813, 0.2762896536254883, 0.277459482421875, 0.27742218353271486, 0.0, 0.0, 0.0, 0.0], [1.8984380078125, 1.771729656982422, 1.645021306152344, 1.5183129553222656, 1.3916046044921875, 1.2648962536621093, 1.1381879028320312, 1.0964400646972656, 1.0546922265625, 1.0129443884277345, 1.0000000000000003e-05, 1.0000000000000003e-05, 0.8828136718749999, 1.0000000000000003e-05, 0.8775647009277343, 1.0000000000000003e-05, 0.7863790893554687, 0.7838156384277344, 0.7279079943847657, 0.7376735217285155, 0.6871979522705078, 0.6619296502685548, 0.6405065246582031, 0.6194496063232424, 0.5995523443603517, 0.5907023352050782, 1.0000000000000003e-05, 0.5430343548583985, 0.5207567456054687, 0.5056201782226561, 0.5172167419433593, 0.4774222180175781, 0.46402513519287114, 0.44693546234130854, 0.4435785623168945, 0.40939921661376955, 0.39465937377929694, 0.3803467727661133, 0.3679262426757813, 0.35477329803466784, 0.34929544754028313, 0.3438175970458984, 0.3452824261474609, 0.3467472552490234, 0.34169664657592774, 0.3366460379028321, 0.3316640930938721, 0.3266821482849121, 0.3157264472961426, 0.30477074630737305, 0.30668570518493654, 0.3086006640625, 0.29961332717895506, 0.29062599029541014, 0.28809305664062496, 0.28556012298583977, 0.286216244354248, 0.2868723657226562, 0.28893228164672846, 0.29099219757080075, 0.2895655150604247, 0.28813883255004874, 0.2797084358978271, 0.27127803924560545, 0.26772277694702146, 0.26413699737548824, 0.24912249908447265, 0.24640646179199222, 0.24454490814208985, 0.24228662994384764, 0.2404555935668945, 0.23935697174072262, 0.2383193844604492, 0.2375564526367187, 0.23731231445312498, 0.23706817626953125, 0.23728179718017578, 0.23749541809082028, 0.23740386627197263, 0.23731231445312498, 0.2379836944580078, 0.2386550744628906, 0.2469918000411987, 0.2553285256195068, 0.2636652511978149, 0.27200197677612303, 0.27141451927185056, 0.2730853399658203, 0.2710644183349609, 0.2726445349121094, 0.2732006274414063, 0.27571176304408485, 0.0, 0.0, 0.0], [1.62109564453125, 1.173181217447917, 0.885869828491211, 0.7591614776611328, 0.6324531268310547, 0.5690989514160156, 1.0366259106445317, 1.0251513586425784, 0.9732694317626955, 0.9213875048828125, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 0.774538387451172, 0.7517114672851561, 0.7485376708984376, 0.7038603833007813, 0.6971465832519532, 0.6596713720703126, 0.6466710137939453, 0.6184730535888674, 0.592350267944336, 0.5788616333007812, 0.5620771331787109, 0.5412033184814455, 0.5253648538208008, 0.5100757000732423, 0.5103198382568359, 0.49451189086914066, 0.4746756634521484, 0.46085133880615237, 0.46191944335937507, 0.42639733764648446, 0.41296973754882804, 0.41629612030029295, 0.4029295547485352, 0.38425298370361327, 0.36627830993652344, 0.36844503631591796, 0.36366908309936524, 0.3588931298828125, 0.3480289807128907, 0.3371648315429688, 0.3384923329162598, 0.33981983428955076, 0.3355626747131347, 0.33130551513671874, 0.32738404556274414, 0.3234625759887695, 0.3195563650512695, 0.3156501541137695, 0.3120033399963379, 0.3083565258789062, 0.3051751001739502, 0.30199367446899417, 0.2989800937652588, 0.29596651306152344, 0.2882914189147949, 0.2806163247680663, 0.28237869728088366, 0.2841410697937011, 0.2774577870178222, 0.2707745042419434, 0.27213252288818357, 0.2734905415344238, 0.2708126508331299, 0.2681347601318359, 0.26036811416625977, 0.25260146820068363, 0.2506483627319336, 0.2486952572631836, 0.24718465225219727, 0.24567404724121095, 0.24474327041625976, 0.24381249359130858, 0.2432021481323242, 0.2425918026733398, 0.24216456085205076, 0.24173731903076173, 0.24144740493774414, 0.24115749084472654, 0.24299234188079832, 0.25132906745910644, 0.25966579303741455, 0.26800251861572266, 0.2674150611114502, 0.2685213122558594, 0.2663037237548828, 0.2680533807373047, 0.26823648437500003, 0.26886717468261717, 0.28548600960867754, 0.0, 0.0], [1.5996113769531248, 1.06641091796875, 0.5332104589843749, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0473680444335938, 1.0083057397460937, 0.9770510107421876, 0.940430283203125, 0.937500625, 0.8735364208984374, 0.8500991552734375, 1.0000000000000003e-05, 0.8176287768554686, 0.7856466748046875, 0.7370021417236328, 1.0000000000000003e-05, 0.7019072778320312, 0.6816438085937502, 0.6489292919921875, 0.639652041015625, 0.6076699389648439, 0.5964395825195312, 0.5731854205322267, 0.552036950378418, 0.540989697570801, 0.5210314010620116, 0.5076953527832031, 0.5134326000976561, 0.49908948181152346, 0.4864248135375977, 0.45654840332031255, 0.4559380578613281, 0.44098459411621094, 0.41272559936523434, 0.41431249755859373, 0.38817445327758787, 0.39050902465820314, 0.3795533236694336, 0.36368434173583986, 0.36162442581176757, 0.3595645098876953, 0.35464359962463377, 0.3497226893615722, 0.3455570816040039, 0.3413914738464356, 0.3370656504058839, 0.3327398269653321, 0.3287878401184082, 0.32483585327148434, 0.3186027002716064, 0.31236954727172844, 0.3095314408874511, 0.30669333450317376, 0.30056699195861813, 0.29444064941406245, 0.29127448234558095, 0.2881083152770995, 0.29435672691345205, 0.30060513854980464, 0.29037422279357905, 0.2801433070373534, 0.27685507087707517, 0.2735668347167969, 0.2795177029418945, 0.26496096374511713, 0.27268183380126954, 0.2608716491699219, 0.267158207397461, 0.25449353912353523, 0.25249465774536134, 0.25049577636718745, 0.2489241368103027, 0.24735249725341796, 0.2459487026977539, 0.24454490814208985, 0.24372094177246093, 0.242896975402832, 0.24333947586059568, 0.24378197631835938, 0.24262231994628908, 0.24146266357421875, 0.24623607368469236, 0.24732960929870607, 0.2556663348770141, 0.26400306045532224, 0.2634156029510498, 0.2639572845458985, 0.26154302917480465, 0.2623636047363282, 0.26330964019775394, 0.26401492828369144, 0.263903031616211, 0.0, 0.0], [1.3925811621093749, 0.6962955810546875, 1.0000000000000003e-05, 1.0004932788085936, 0.5002516394042968, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 0.7896749548339843, 0.7728294201660157, 0.7416407672119141, 0.7283962707519531, 0.7009917596435546, 0.6770051831054689, 1.0000000000000003e-05, 0.6418492846679689, 0.6170082244873047, 0.6005288970947267, 0.46759565612792964, 0.5716595568847658, 0.5531050549316407, 0.5344895184326173, 0.4232235412597656, 0.5040332800292968, 0.5214891601562499, 0.5014087945556642, 0.4867605035400391, 0.4706168661499024, 0.45834892242431646, 0.4473779627990722, 0.4354609677124024, 0.42722130401611336, 0.4154111193847656, 0.40097644927978515, 0.3824829818725586, 0.3836731555175781, 0.3745790081787109, 0.36607994766235347, 0.3620745555877686, 0.35806916351318363, 0.35402562484741207, 0.34998208618164056, 0.3466099275207519, 0.34323776885986323, 0.3427494924926757, 0.3422612161254882, 0.33346461219787593, 0.3246680082702636, 0.3219214537048339, 0.31917489913940417, 0.3147575238800048, 0.31034014862060544, 0.308577776107788, 0.30681540359497067, 0.3033745810699463, 0.2999337585449219, 0.2998727239990234, 0.299811689453125, 0.2953637969207763, 0.2909159043884277, 0.2879404702758788, 0.28496503616332997, 0.2814860670471191, 0.2779918392944336, 0.27448235290527345, 0.28337813796997063, 0.2687451055908203, 0.2661358787536621, 0.26363346237182617, 0.2611310459899902, 0.2605969937133789, 0.2600629414367676, 0.2572629816436768, 0.254463021850586, 0.25333388275146485, 0.25220474365234374, 0.2511824150085449, 0.25016008636474607, 0.25012956909179684, 0.2500990518188476, 0.24912249908447265, 0.25131465652465823, 0.25166687671661375, 0.26000360229492187, 0.2594161447906494, 0.25939325683593756, 0.25678233459472655, 0.25667382873535155, 0.2587184860229493, 0.25901348632812504, 0.25968147552490234, 0.25893888854980474, 0.0], [1.158207333984375, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 1.0000000000000003e-05, 0.8190936059570311, 0.7955342712402342, 0.7703880383300781, 0.7447535290527343, 0.7237576452636718, 0.7027617614746093, 0.6820100158691407, 0.661258270263672, 0.6441991146850587, 0.6271399591064455, 1.0000000000000003e-05, 0.5928995788574221, 1.0000000000000003e-05, 0.5607954077148438, 0.5467879794311524, 0.5293931338500978, 0.5177050183105469, 0.5036670727539063, 0.5221910574340819, 0.5084277673339843, 0.49551896087646485, 0.48126739440917965, 0.46851117431640626, 0.45898978515625005, 0.4443567527770996, 0.43341631042480466, 0.4234981967163086, 0.4133969793701171, 0.4036314520263672, 0.38507695007324216, 0.387350486907959, 0.3796753927612304, 0.37161883270263674, 0.36499658447265626, 0.3599230878448486, 0.35743974475860596, 0.35495640167236325, 0.351294328918457, 0.34754070434570306, 0.34604154331207265, 0.34454238227844236, 0.3339300006103516, 0.3352575019836425, 0.33073713092803947, 0.3262167598724365, 0.3292761164855957, 0.3190528300476074, 0.3166419654846191, 0.3142311009216308, 0.31508558456420893, 0.30902790588378903, 0.3059151440429687, 0.30280238220214845, 0.3062508340454102, 0.2982934551239014, 0.2974160835266113, 0.29653871192932124, 0.2987588435363769, 0.29727112648010245, 0.2957834094238281, 0.29003853279113767, 0.2842936561584472, 0.28154710159301755, 0.2788005470275879, 0.276374423828125, 0.2739483006286621, 0.2723232558441162, 0.27069821105957037, 0.26879088150024416, 0.26688355194091795, 0.26471682556152343, 0.2625500991821289, 0.26155828781127927, 0.26056647644042963, 0.259071130065918, 0.25757578369140627, 0.2571790591430664, 0.25678233459472655, 0.256393239364624, 0.2560041441345215, 0.2554166866302491, 0.2548292291259766, 0.25202164001464844, 0.25098405273437496, 0.2541273318481446, 0.2539747454833985, 0.2548292291259766, 0.25534802276611335, 0.2539747454833985], [2.1376999682617184, 1.0844772338867186, 0.92773509765625, 0.82226740234375, 0.41113870117187495, 1.0000000000000003e-05, 0.8084735949707031, 0.788088056640625, 0.7515893981933592, 0.7325466198730468, 0.7122831506347657, 0.6920196813964845, 0.6665987930297852, 0.6411779046630859, 0.6298865136718751, 0.6185951226806643, 0.6051064880371095, 0.5914957843017579, 0.5789226678466798, 0.5663495513916017, 0.5414169393920901, 0.530400203857422, 0.5146227737426757, 0.5065051791381835, 0.5189257092285156, 0.5154772573852539, 0.49216206085205083, 0.47995515167236324, 0.46774824249267577, 0.4493463269042969, 0.43921459228515625, 0.4208737112426758, 0.41962250305175786, 0.40263964065551755, 0.397268600616455, 0.3913787669372558, 0.3840698800659179, 0.38468022552490233, 0.3706270213317871, 0.36177701217651365, 0.35929366909027094, 0.3568103260040283, 0.3543269829177855, 0.3518436398315429, 0.3503444787979125, 0.3488453177642822, 0.34734615673065183, 0.34584699569702143, 0.34132662464141844, 0.3368062535858154, 0.33228588253021235, 0.32776551147460936, 0.3253546469116211, 0.32294378234863275, 0.32053291778564447, 0.3181220532226562, 0.31500929138183587, 0.3118965295410156, 0.30878376770019533, 0.305671005859375, 0.30479363426208494, 0.30391626266479493, 0.3030388910675049, 0.30216151947021486, 0.29573000419616696, 0.28929848892211907, 0.28562878684997556, 0.28195908477783205, 0.2812877047729492, 0.2806163247680663, 0.2768398122406005, 0.27306329971313476, 0.27173579833984374, 0.2704082969665527, 0.2694546321868896, 0.2685009674072265, 0.2669751037597656, 0.26544924011230464, 0.26267216827392575, 0.25989509643554687, 0.2588117332458496, 0.25772837005615234, 0.2567289293670655, 0.25572948867797857, 0.25547772117614753, 0.25522595367431644, 0.2560041441345215, 0.25678233459472655, 0.25205215728759767, 0.2514723291015625, 0.250282155456543, 0.25269302001953126, 0.25345595184326175, 0.2551954364013672, 0.2517469845581054]]

const VolatilitySurface = ({ data }: { data: number[][] }) => {
  const meshRef = useRef<THREE.Mesh>(null)
  
  const { positions, indices } = useMemo(() => {
    const positions: number[] = []
    const indices: number[] = []

    data.forEach((row, weekIndex) => {
      row.forEach((volatility, strikeIndex) => {
        positions.push(strikeIndex, weekIndex, volatility)
      })
    })

    for (let i = 0; i < data.length - 1; i++) {
      for (let j = 0; j < data[i].length - 1; j++) {
        const a = i * data[i].length + j
        const b = a + 1
        const c = (i + 1) * data[i].length + j
        const d = c + 1
        indices.push(a, b, c)
        indices.push(b, d, c)
      }
    }

    return { positions, indices }
  }, [data])

  const geometry = useMemo(() => {
    const geometry = new THREE.BufferGeometry()
    geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3))
    geometry.setIndex(indices)
    geometry.computeVertexNormals()
    return geometry
  }, [positions, indices])

  useFrame(() => {
    if (meshRef.current) {
      meshRef.current.rotation.x += 0.001
      meshRef.current.rotation.y += 0.001
    }
  })

  return (
    <mesh ref={meshRef} geometry={geometry}>
      <meshBasicMaterial attach="material" color="#000000" wireframe={true} />
    </mesh>
  )
}

const AxisLabels = () => {
  return (
    <>
      <Text position={[2, 0, 0]} rotation={[0, 0, 0]} color="black" fontSize={0.5}>
        Strike Price
      </Text>
      <Text position={[0, 2, 0]} rotation={[0, 0, -Math.PI / 2]} color="black" fontSize={0.5}>
        Weeks until Expiration
      </Text>
      <Text position={[0, 0, 2]} rotation={[0, Math.PI / 2, 0]} color="black" fontSize={0.5}>
        Implied Volatility
      </Text>
    </>
  )
}

const HandDrawnLine = ({ start, end }: { start: [number, number, number], end: [number, number, number] }) => {
  const curve = useMemo(() => {
    const curvePoints = []
    const segments = 10
    for (let i = 0; i <= segments; i++) {
      const t = i / segments
      const x = start[0] + (end[0] - start[0]) * t
      const y = start[1] + (end[1] - start[1]) * t
      const z = start[2] + (end[2] - start[2]) * t
      const offset = Math.sin(t * Math.PI) * 0.05
      curvePoints.push(
        new THREE.Vector3(
          x + (Math.random() - 0.5) * offset,
          y + (Math.random() - 0.5) * offset,
          z + (Math.random() - 0.5) * offset
        )
      )
    }
    return new THREE.CatmullRomCurve3(curvePoints)
  }, [start, end])

  const geometry = useMemo(() => {
    return new THREE.TubeGeometry(curve, 20, 0.01, 8, false)
  }, [curve])

  return (
    <mesh geometry={geometry}>
      <meshBasicMaterial attach="material" color="#000000" />
    </mesh>
  )
}

const HandDrawnAxes = () => {
  return (
    <>
      <HandDrawnLine start={[0, 0, 0]} end={[3, 0, 0]} />
      <HandDrawnLine start={[0, 0, 0]} end={[0, 3, 0]} />
      <HandDrawnLine start={[0, 0, 0]} end={[0, 0, 3]} />
    </>
  )
}

export default function VolatilityGraph() {
  return (
    <div className="w-full h-screen">
      <Canvas camera={{ position: [5, 5, 5] }}>
        <ambientLight intensity={0.5} />
        <pointLight position={[10, 10, 10]} />
        <VolatilitySurface data={sampleData} />
        <HandDrawnAxes />
        <AxisLabels />
        <OrbitControls enablePan={true} enableZoom={true} enableRotate={true} />
      </Canvas>
    </div>
  )
}
